export type LocaleCode = 'en' | 'ar' | 'cs' | 'ru';

export const SUPPORTED_LOCALES: LocaleCode[] = ['en', 'ar', 'cs', 'ru'];

type Dict = Record<string, string>;

const en: Dict = {
  appName: 'CareChair Professionals',
  authTitle: 'Salon operations for mobile and tablet',
  authSubtitle: 'Live calendar, team schedule, and booking control in one app.',
  phoneOtp: 'Phone OTP',
  emailLogin: 'Email',
  salonAdmin: 'Salon Admin',
  superadmin: 'Superadmin',
  phone: 'Phone number',
  code: 'Verification code',
  sendCode: 'Send code',
  verify: 'Verify',
  email: 'Email',
  password: 'Password',
  login: 'Login',
  pleaseWait: 'Please wait...',
  missingConfig: 'Supabase config is missing. Add EXPO_PUBLIC_SUPABASE_URL and EXPO_PUBLIC_SUPABASE_ANON_KEY.',
  invalidPhone: 'Enter a valid phone number with country code.',
  enterCode: 'Enter verification code.',
  enterEmailPassword: 'Email and password are required.',
  checkNamePhone: 'Please check customer name and phone number.',
  otpWhatsapp: 'Code sent to WhatsApp.',
  otpSmsFallback: 'WhatsApp unavailable, code sent by SMS.',
  deliveryChannel: 'Delivery channel',
  pendingTitle: 'Account pending approval',
  pendingSubtitle: 'Your onboarding was submitted. Superadmin approval is required before opening the workspace.',
  onboardingTitle: 'Onboarding required',
  onboardingSubtitle: 'No salon mapping found for this account yet. Complete onboarding first.',
  onboardingFormTitle: 'Create your salon workspace',
  salonName: 'Salon name',
  countryCode: 'Country code',
  city: 'City',
  adminPasscode: 'Admin passcode',
  submitOnboarding: 'Submit onboarding',
  onboardingSubmitting: 'Submitting...',
  onboardingNameRequired: 'Salon name is required.',
  onboardingCountryRequired: 'Country code is required.',
  onboardingSubmitted: 'Onboarding submitted successfully. Waiting for approval.',
  logout: 'Logout',
  openDashboard: 'Open dashboard',
  appointmentCalendar: 'Appointment Calendar',
  today: 'Today',
  prev: 'Prev',
  next: 'Next',
  bookings: 'Bookings',
  confirmed: 'Confirmed',
  pending: 'Pending',
  occupancy: 'Occupancy',
  all: 'All',
  allEmployees: 'All employees',
  calendar: 'Calendar',
  agenda: 'Agenda',
  team: 'Team',
  loading: 'Loading...',
  noData: 'No data found for this day.',
  noServices: 'Add at least one active service first.',
  noStaff: 'No active staff found.',
  service: 'Service',
  employee: 'Employee',
  addBooking: 'Add booking +',
  createBooking: 'Create booking',
  customerName: 'Customer name',
  customerPhone: 'Customer phone',
  startTime: 'Start time',
  duration: 'Duration',
  minutes: 'min',
  save: 'Save',
  cancel: 'Cancel',
  saving: 'Saving...',
  saved: 'Saved',
  slotUnavailable: 'This slot is not available.',
  outsideHours: 'This booking is outside working hours.',
  overlap: 'This slot overlaps another booking.',
  invalidServiceStaff: 'Selected employee does not provide this service.',
  dataLoadFailed: 'Failed to load data.',
  saveFailed: 'Failed to save booking.',
  updateFailed: 'Failed to update booking.',
  moveHint: 'Drag a booking card to another time slot, then save or cancel.',
  saveMove: 'Save move',
  cancelMove: 'Cancel move',
  movePending: 'Booking moved locally. Save to apply or cancel to revert.',
  teamLoad: 'Team load',
  slots: 'slots',
  superadminOnly: 'Superadmin view is connected. Calendar data is salon-admin only.',
  accessDenied: 'Access denied for selected role.',
  statusPendingApproval: 'Pending approval',
  statusActive: 'Active',
  statusTrialing: 'Trialing',
  statusSuspended: 'Suspended',
  statusRejected: 'Rejected',
  statusDraft: 'Draft',
  time: 'Time'
};

const ar: Dict = {
  appName: 'CareChair Professionals',
  authTitle: 'إدارة المركز على الجوال والتابلت',
  authSubtitle: 'تقويم حي، جدول الفريق، وتحكم كامل بالحجوزات في تطبيق واحد.',
  phoneOtp: 'رمز الهاتف',
  emailLogin: 'البريد الإلكتروني',
  salonAdmin: 'مدير الصالون',
  superadmin: 'سوبر أدمن',
  phone: 'رقم الهاتف',
  code: 'رمز التحقق',
  sendCode: 'إرسال الرمز',
  verify: 'تحقق',
  email: 'البريد الإلكتروني',
  password: 'كلمة المرور',
  login: 'تسجيل الدخول',
  pleaseWait: 'يرجى الانتظار...',
  missingConfig: 'إعدادات Supabase ناقصة. أضف EXPO_PUBLIC_SUPABASE_URL و EXPO_PUBLIC_SUPABASE_ANON_KEY.',
  invalidPhone: 'أدخل رقم هاتف صحيح مع رمز الدولة.',
  enterCode: 'أدخل رمز التحقق.',
  enterEmailPassword: 'البريد وكلمة المرور مطلوبان.',
  checkNamePhone: 'يرجى التحقق من اسم العميل ورقم الهاتف.',
  otpWhatsapp: 'تم إرسال الرمز عبر واتساب.',
  otpSmsFallback: 'واتساب غير متاح، تم إرسال الرمز عبر SMS.',
  deliveryChannel: 'قناة الإرسال',
  pendingTitle: 'الحساب بانتظار الموافقة',
  pendingSubtitle: 'تم إرسال طلب الانضمام. يلزم موافقة السوبر أدمن قبل فتح مساحة العمل.',
  onboardingTitle: 'إعداد أولي مطلوب',
  onboardingSubtitle: 'لا يوجد ربط صالون لهذا الحساب بعد. أكمل الإعداد أولاً.',
  onboardingFormTitle: 'أنشئ مساحة عمل الصالون',
  salonName: 'اسم الصالون',
  countryCode: 'رمز الدولة',
  city: 'المدينة',
  adminPasscode: 'رمز دخول الإدارة',
  submitOnboarding: 'إرسال الإعداد',
  onboardingSubmitting: 'جارٍ الإرسال...',
  onboardingNameRequired: 'اسم الصالون مطلوب.',
  onboardingCountryRequired: 'رمز الدولة مطلوب.',
  onboardingSubmitted: 'تم إرسال الإعداد بنجاح. بانتظار الموافقة.',
  logout: 'تسجيل الخروج',
  openDashboard: 'فتح اللوحة',
  appointmentCalendar: 'تقويم المواعيد',
  today: 'اليوم',
  prev: 'السابق',
  next: 'التالي',
  bookings: 'الحجوزات',
  confirmed: 'مؤكد',
  pending: 'معلق',
  occupancy: 'الإشغال',
  all: 'الكل',
  allEmployees: 'كل الموظفين',
  calendar: 'التقويم',
  agenda: 'الأجندة',
  team: 'الفريق',
  loading: 'جار التحميل...',
  noData: 'لا توجد بيانات لهذا اليوم.',
  noServices: 'أضف خدمة فعالة واحدة على الأقل أولاً.',
  noStaff: 'لا يوجد موظفون نشطون.',
  service: 'الخدمة',
  employee: 'الموظف',
  addBooking: 'إضافة حجز +',
  createBooking: 'إنشاء حجز',
  customerName: 'اسم العميل',
  customerPhone: 'هاتف العميل',
  startTime: 'وقت البدء',
  duration: 'المدة',
  minutes: 'دقيقة',
  save: 'حفظ',
  cancel: 'إلغاء',
  saving: 'جارٍ الحفظ...',
  saved: 'تم الحفظ',
  slotUnavailable: 'هذا الموعد غير متاح.',
  outsideHours: 'هذا الحجز خارج ساعات العمل.',
  overlap: 'هذا الموعد يتداخل مع حجز آخر.',
  invalidServiceStaff: 'الموظف المحدد لا يقدم هذه الخدمة.',
  dataLoadFailed: 'فشل تحميل البيانات.',
  saveFailed: 'فشل حفظ الحجز.',
  updateFailed: 'فشل تحديث الحجز.',
  moveHint: 'اسحب بطاقة الحجز إلى وقت آخر، ثم احفظ أو ألغِ.',
  saveMove: 'حفظ النقل',
  cancelMove: 'إلغاء النقل',
  movePending: 'تم نقل الحجز محلياً. احفظ للتطبيق أو ألغِ للرجوع.',
  teamLoad: 'حمولة الفريق',
  slots: 'مواعيد',
  superadminOnly: 'وضع السوبر أدمن متصل. بيانات التقويم متاحة لمدير الصالون فقط.',
  accessDenied: 'لا يوجد صلاحية للدور المحدد.',
  statusPendingApproval: 'بانتظار الموافقة',
  statusActive: 'نشط',
  statusTrialing: 'تجريبي',
  statusSuspended: 'معلّق',
  statusRejected: 'مرفوض',
  statusDraft: 'مسودة',
  time: 'الوقت'
};

const cs: Dict = {
  appName: 'CareChair Professionals',
  authTitle: 'Salonový provoz pro mobil a tablet',
  authSubtitle: 'Živý kalendář, týmový rozvrh a kontrola rezervací v jedné aplikaci.',
  phoneOtp: 'OTP telefon',
  emailLogin: 'E-mail',
  salonAdmin: 'Správce salonu',
  superadmin: 'Superadmin',
  phone: 'Telefon',
  code: 'Ověřovací kód',
  sendCode: 'Poslat kód',
  verify: 'Ověřit',
  email: 'E-mail',
  password: 'Heslo',
  login: 'Přihlásit se',
  pleaseWait: 'Čekejte prosím...',
  missingConfig: 'Chybí konfigurace Supabase. Přidejte EXPO_PUBLIC_SUPABASE_URL a EXPO_PUBLIC_SUPABASE_ANON_KEY.',
  invalidPhone: 'Zadejte platné telefonní číslo s předvolbou.',
  enterCode: 'Zadejte ověřovací kód.',
  enterEmailPassword: 'E-mail a heslo jsou povinné.',
  checkNamePhone: 'Zkontrolujte jméno klienta a telefonní číslo.',
  otpWhatsapp: 'Kód odeslán přes WhatsApp.',
  otpSmsFallback: 'WhatsApp není dostupný, kód byl odeslán přes SMS.',
  deliveryChannel: 'Kanál doručení',
  pendingTitle: 'Účet čeká na schválení',
  pendingSubtitle: 'Onboarding byl odeslán. Před otevřením workspace je nutné schválení superadminem.',
  onboardingTitle: 'Vyžadován onboarding',
  onboardingSubtitle: 'K tomuto účtu zatím není přiřazen salon. Nejprve dokončete onboarding.',
  onboardingFormTitle: 'Vytvořte pracovní prostor salonu',
  salonName: 'Název salonu',
  countryCode: 'Kód země',
  city: 'Město',
  adminPasscode: 'Admin kód',
  submitOnboarding: 'Odeslat onboarding',
  onboardingSubmitting: 'Odesílání...',
  onboardingNameRequired: 'Název salonu je povinný.',
  onboardingCountryRequired: 'Kód země je povinný.',
  onboardingSubmitted: 'Onboarding byl úspěšně odeslán. Čeká se na schválení.',
  logout: 'Odhlásit',
  openDashboard: 'Otevřít dashboard',
  appointmentCalendar: 'Kalendář rezervací',
  today: 'Dnes',
  prev: 'Předchozí',
  next: 'Další',
  bookings: 'Rezervace',
  confirmed: 'Potvrzeno',
  pending: 'Čeká',
  occupancy: 'Vytížení',
  all: 'Vše',
  allEmployees: 'Všichni zaměstnanci',
  calendar: 'Kalendář',
  agenda: 'Agenda',
  team: 'Tým',
  loading: 'Načítání...',
  noData: 'Pro tento den nejsou data.',
  noServices: 'Nejprve přidejte alespoň jednu aktivní službu.',
  noStaff: 'Nenalezen aktivní personál.',
  service: 'Služba',
  employee: 'Zaměstnanec',
  addBooking: 'Přidat rezervaci +',
  createBooking: 'Vytvořit rezervaci',
  customerName: 'Jméno klienta',
  customerPhone: 'Telefon klienta',
  startTime: 'Začátek',
  duration: 'Doba trvání',
  minutes: 'min',
  save: 'Uložit',
  cancel: 'Zrušit',
  saving: 'Ukládání...',
  saved: 'Uloženo',
  slotUnavailable: 'Tento slot není dostupný.',
  outsideHours: 'Tato rezervace je mimo pracovní dobu.',
  overlap: 'Tento slot se překrývá s jinou rezervací.',
  invalidServiceStaff: 'Vybraný zaměstnanec tuto službu neposkytuje.',
  dataLoadFailed: 'Načtení dat selhalo.',
  saveFailed: 'Uložení rezervace selhalo.',
  updateFailed: 'Aktualizace rezervace selhala.',
  moveHint: 'Přetáhněte kartu rezervace na jiný čas, poté uložte nebo zrušte.',
  saveMove: 'Uložit přesun',
  cancelMove: 'Zrušit přesun',
  movePending: 'Rezervace byla lokálně přesunuta. Uložte pro potvrzení nebo zrušte pro návrat.',
  teamLoad: 'Vytížení týmu',
  slots: 'sloty',
  superadminOnly: 'Režim superadmin je připojen. Data kalendáře jsou jen pro správce salonu.',
  accessDenied: 'Přístup odepřen pro vybranou roli.',
  statusPendingApproval: 'Čeká na schválení',
  statusActive: 'Aktivní',
  statusTrialing: 'Zkušební',
  statusSuspended: 'Pozastaveno',
  statusRejected: 'Zamítnuto',
  statusDraft: 'Koncept',
  time: 'Čas'
};

const ru: Dict = {
  appName: 'CareChair Professionals',
  authTitle: 'Управление салоном для телефона и планшета',
  authSubtitle: 'Живой календарь, расписание команды и контроль записей в одном приложении.',
  phoneOtp: 'OTP по телефону',
  emailLogin: 'Email',
  salonAdmin: 'Админ салона',
  superadmin: 'Суперадмин',
  phone: 'Номер телефона',
  code: 'Код подтверждения',
  sendCode: 'Отправить код',
  verify: 'Подтвердить',
  email: 'Email',
  password: 'Пароль',
  login: 'Войти',
  pleaseWait: 'Подождите...',
  missingConfig: 'Отсутствует конфигурация Supabase. Добавьте EXPO_PUBLIC_SUPABASE_URL и EXPO_PUBLIC_SUPABASE_ANON_KEY.',
  invalidPhone: 'Введите корректный номер с кодом страны.',
  enterCode: 'Введите код подтверждения.',
  enterEmailPassword: 'Email и пароль обязательны.',
  checkNamePhone: 'Проверьте имя клиента и номер телефона.',
  otpWhatsapp: 'Код отправлен в WhatsApp.',
  otpSmsFallback: 'WhatsApp недоступен, код отправлен по SMS.',
  deliveryChannel: 'Канал доставки',
  pendingTitle: 'Аккаунт ожидает одобрения',
  pendingSubtitle: 'Онбординг отправлен. Для открытия рабочего пространства нужно одобрение суперадмина.',
  onboardingTitle: 'Требуется онбординг',
  onboardingSubtitle: 'Для этого аккаунта пока не найден салон. Сначала завершите онбординг.',
  onboardingFormTitle: 'Создайте рабочее пространство салона',
  salonName: 'Название салона',
  countryCode: 'Код страны',
  city: 'Город',
  adminPasscode: 'Код администратора',
  submitOnboarding: 'Отправить онбординг',
  onboardingSubmitting: 'Отправка...',
  onboardingNameRequired: 'Название салона обязательно.',
  onboardingCountryRequired: 'Код страны обязателен.',
  onboardingSubmitted: 'Онбординг успешно отправлен. Ожидайте одобрения.',
  logout: 'Выйти',
  openDashboard: 'Открыть панель',
  appointmentCalendar: 'Календарь записей',
  today: 'Сегодня',
  prev: 'Назад',
  next: 'Вперед',
  bookings: 'Записи',
  confirmed: 'Подтверждено',
  pending: 'Ожидает',
  occupancy: 'Загрузка',
  all: 'Все',
  allEmployees: 'Все сотрудники',
  calendar: 'Календарь',
  agenda: 'Повестка',
  team: 'Команда',
  loading: 'Загрузка...',
  noData: 'Нет данных за этот день.',
  noServices: 'Сначала добавьте хотя бы одну активную услугу.',
  noStaff: 'Активные сотрудники не найдены.',
  service: 'Услуга',
  employee: 'Сотрудник',
  addBooking: 'Добавить запись +',
  createBooking: 'Создать запись',
  customerName: 'Имя клиента',
  customerPhone: 'Телефон клиента',
  startTime: 'Время начала',
  duration: 'Длительность',
  minutes: 'мин',
  save: 'Сохранить',
  cancel: 'Отмена',
  saving: 'Сохранение...',
  saved: 'Сохранено',
  slotUnavailable: 'Этот слот недоступен.',
  outsideHours: 'Запись вне рабочих часов.',
  overlap: 'Этот слот пересекается с другой записью.',
  invalidServiceStaff: 'Выбранный сотрудник не оказывает эту услугу.',
  dataLoadFailed: 'Не удалось загрузить данные.',
  saveFailed: 'Не удалось сохранить запись.',
  updateFailed: 'Не удалось обновить запись.',
  moveHint: 'Перетащите карточку записи на другое время, затем сохраните или отмените.',
  saveMove: 'Сохранить перенос',
  cancelMove: 'Отменить перенос',
  movePending: 'Запись перемещена локально. Сохраните для применения или отмените для отката.',
  teamLoad: 'Загрузка команды',
  slots: 'слотов',
  superadminOnly: 'Режим суперадмина подключен. Данные календаря доступны только администратору салона.',
  accessDenied: 'Доступ запрещен для выбранной роли.',
  statusPendingApproval: 'Ожидает одобрения',
  statusActive: 'Активен',
  statusTrialing: 'Пробный',
  statusSuspended: 'Приостановлен',
  statusRejected: 'Отклонен',
  statusDraft: 'Черновик',
  time: 'Время'
};

const DICTS: Record<LocaleCode, Dict> = {en, ar, cs, ru};

export function detectLocaleFromRuntime(): LocaleCode {
  const locale = String(Intl.DateTimeFormat().resolvedOptions().locale || 'en').toLowerCase();
  if (locale.startsWith('ar')) return 'ar';
  if (locale.startsWith('cs')) return 'cs';
  if (locale.startsWith('ru')) return 'ru';
  return 'en';
}

export function isRtlLocale(locale: LocaleCode): boolean {
  return locale === 'ar';
}

export function tr(locale: LocaleCode, key: string, params?: Record<string, string | number>): string {
  const dict = DICTS[locale] || DICTS.en;
  let value = dict[key] || DICTS.en[key] || key;
  if (!params) return value;
  for (const [paramKey, paramValue] of Object.entries(params)) {
    value = value.replace(new RegExp(`{{\\s*${paramKey}\\s*}}`, 'g'), String(paramValue));
  }
  return value;
}
